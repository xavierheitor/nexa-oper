model TipoChecklist {
  id   Int    @id @default(autoincrement())
  nome String @db.VarChar(255)

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  Checklist Checklist[]

  ChecklistTipoEquipeRelacao ChecklistTipoEquipeRelacao[]
}

model Checklist {
  id   Int    @id @default(autoincrement())
  nome String @db.VarChar(255)

  tipoChecklistId Int
  tipoChecklist   TipoChecklist @relation(fields: [tipoChecklistId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  ChecklistPerguntaRelacao ChecklistPerguntaRelacao[]
  ChecklistOpcaoRespostaRelacao ChecklistOpcaoRespostaRelacao[]
  ChecklistTipoVeiculoRelacao ChecklistTipoVeiculoRelacao[]
  ChecklistTipoEquipeRelacao ChecklistTipoEquipeRelacao[]
}

model ChecklistPergunta {
  id   Int    @id @default(autoincrement())
  nome String @db.VarChar(255)

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  ChecklistPerguntaRelacao ChecklistPerguntaRelacao[]
}

model ChecklistPerguntaRelacao {
  id Int @id @default(autoincrement())

  checklistPerguntaId Int
  checklistPergunta   ChecklistPergunta @relation(fields: [checklistPerguntaId], references: [id])

  checklistId Int
  checklist   Checklist @relation(fields: [checklistId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)
}

model ChecklistOpcaoResposta {
  id   Int    @id @default(autoincrement())
  nome String @db.VarChar(255)

  geraPendencia Boolean @default(false)

  checklistOpcaoRespostaRelacao ChecklistOpcaoRespostaRelacao[]

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)
}

model ChecklistOpcaoRespostaRelacao {
  id Int @id @default(autoincrement())

  checklistOpcaoRespostaId Int
  checklistOpcaoResposta   ChecklistOpcaoResposta @relation(fields: [checklistOpcaoRespostaId], references: [id])

  checklistId Int
  checklist   Checklist @relation(fields: [checklistId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)
}

model ChecklistTipoVeiculoRelacao{
  id Int @id @default(autoincrement())

  checklistId Int
  checklist   Checklist @relation(fields: [checklistId], references: [id])

  tipoVeiculoId Int
  tipoVeiculo   TipoVeiculo @relation(fields: [tipoVeiculoId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  // Índice único condicional: apenas um checklist ativo por tipo de veículo
  @@unique([tipoVeiculoId, deletedAt], map: "unique_active_checklist_tipo_veiculo")
}

model ChecklistTipoEquipeRelacao{
  id Int @id @default(autoincrement())

  checklistId Int
  checklist   Checklist @relation(fields: [checklistId], references: [id])

  tipoEquipeId Int
  tipoEquipe   TipoEquipe @relation(fields: [tipoEquipeId], references: [id])

  // NOVO CAMPO: referência direta ao tipo de checklist
  tipoChecklistId Int
  tipoChecklist   TipoChecklist @relation(fields: [tipoChecklistId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  // UNIQUE KEY: permite múltiplos checklists por tipo de equipe,
  // mas não permite checklists do mesmo tipo ativos simultaneamente
  @@unique([tipoEquipeId, tipoChecklistId, deletedAt], map: "unique_active_checklist_tipo_por_equipe")
}
