model Apr {
  id   Int    @id @default(autoincrement())
  nome String @db.VarChar(255)

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  AprPerguntaRelacao      AprPerguntaRelacao[]
  AprOpcaoRespostaRelacao AprOpcaoRespostaRelacao[]
  AprGrupoRelacao         AprGrupoRelacao[]
  AprTipoAtividadeRelacao AprTipoAtividadeRelacao[]
}

model AprPergunta {
  id   Int    @id @default(autoincrement())
  nome String @db.VarChar(255)

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  AprPerguntaRelacao      AprPerguntaRelacao[]
  AprGrupoPerguntaRelacao AprGrupoPerguntaRelacao[]
}

model AprPerguntaRelacao {
  id Int @id @default(autoincrement())

  aprPerguntaId Int
  aprPergunta   AprPergunta @relation(fields: [aprPerguntaId], references: [id])

  ordem Int @default(0)

  aprId Int
  apr   Apr @relation(fields: [aprId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)
}

model AprOpcaoResposta {
  id   Int    @id @default(autoincrement())
  nome String @db.VarChar(255)

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  AprOpcaoRespostaRelacao      AprOpcaoRespostaRelacao[]
  AprGrupoOpcaoRespostaRelacao AprGrupoOpcaoRespostaRelacao[]
}

model AprGrupoPergunta {
  id Int @id @default(autoincrement())

  nome         String @db.VarChar(255)
  tipoResposta String @default("checkbox") @db.VarChar(30)

  AprGrupoRelacao              AprGrupoRelacao[]
  AprGrupoPerguntaRelacao      AprGrupoPerguntaRelacao[]
  AprGrupoOpcaoRespostaRelacao AprGrupoOpcaoRespostaRelacao[]

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  @@index([tipoResposta])
}

model AprGrupoRelacao {
  id Int @id @default(autoincrement())

  aprId Int
  apr   Apr @relation(fields: [aprId], references: [id])

  aprGrupoPerguntaId Int
  aprGrupoPergunta   AprGrupoPergunta @relation(fields: [aprGrupoPerguntaId], references: [id])

  ordem Int @default(0)

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  @@unique([aprId, aprGrupoPerguntaId, deletedAt], map: "uq_apr_grupo_rel_ativo")
  @@index([aprId, ordem])
}

model AprGrupoPerguntaRelacao {
  id Int @id @default(autoincrement())

  aprGrupoPerguntaId Int
  aprGrupoPergunta   AprGrupoPergunta @relation(fields: [aprGrupoPerguntaId], references: [id])

  aprPerguntaId Int
  aprPergunta   AprPergunta @relation(fields: [aprPerguntaId], references: [id])

  ordem Int @default(0)

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  @@unique([aprGrupoPerguntaId, aprPerguntaId, deletedAt], map: "uq_apr_grupo_pergunta_rel_ativo")
  @@index([aprGrupoPerguntaId, ordem])
}

model AprGrupoOpcaoRespostaRelacao {
  id Int @id @default(autoincrement())

  aprGrupoPerguntaId Int
  aprGrupoPergunta   AprGrupoPergunta @relation(fields: [aprGrupoPerguntaId], references: [id])

  aprOpcaoRespostaId Int
  aprOpcaoResposta   AprOpcaoResposta @relation(fields: [aprOpcaoRespostaId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  @@unique([aprGrupoPerguntaId, aprOpcaoRespostaId, deletedAt], map: "uq_apr_grupo_opcao_rel_ativo")
  @@index([aprGrupoPerguntaId])
}

model AprOpcaoRespostaRelacao {
  id Int @id @default(autoincrement())

  aprOpcaoRespostaId Int
  aprOpcaoResposta   AprOpcaoResposta @relation(fields: [aprOpcaoRespostaId], references: [id])

  aprId Int
  apr   Apr @relation(fields: [aprId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)
}

model AprTipoAtividadeRelacao {
  id Int @id @default(autoincrement())

  aprId Int
  apr   Apr @relation(fields: [aprId], references: [id])

  tipoAtividadeId Int
  tipoAtividade   TipoAtividade @relation(fields: [tipoAtividadeId], references: [id])

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  // Índice único condicional: apenas um apr ativo por tipo de atividade
  @@unique([tipoAtividadeId, deletedAt], map: "unique_active_apr_tipo_atividade")
}
