/// Evidências genéricas de upload (reprovas, assinaturas, APR, etc.)
model UploadEvidence {
  id Int @id @default(autoincrement())

  tipo       String @db.VarChar(100)
  entityType String @db.VarChar(100)
  entityId   String @db.VarChar(50)

  url          String  @db.VarChar(1024)
  path         String  @db.VarChar(1024)
  tamanho      Int
  mimeType     String? @db.VarChar(100)
  nomeArquivo  String? @db.VarChar(255)
  checksum     String? @db.VarChar(64)
  idempotencyKey String? @unique(map: "uk_upload_evidence_idempotency") @db.VarChar(255)

  createdAt DateTime  @default(now())
  createdBy String?   @db.VarChar(255)

  @@index([tipo])
  @@index([entityType, entityId])
  @@index([checksum], map: "idx_upload_evidence_checksum")
  @@map("UploadEvidences")
}

model MobilePhoto {
  id Int @id @default(autoincrement())

  turnoId Int
  tipo    String @db.VarChar(100)

  checklistPreenchidoId Int?
  checklistUuid         String? @db.VarChar(36) // UUID do checklist preenchido
  checklistPerguntaId   Int? // ID remoto da pergunta (enviado como checklistPerguntaId pelo app)
  sequenciaAssinatura   Int?
  servicoId             Int?

  fileName    String @db.VarChar(255)
  mimeType    String @db.VarChar(100)
  fileSize    Int
  checksum    String @unique @db.VarChar(128)
  storagePath String @db.VarChar(1024)
  url         String @db.VarChar(1024)

  capturedAt DateTime? @default(now())

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  @@index([turnoId], map: "idx_mobile_photo_turno")
}

model MobileLocation {
  id Int @id @default(autoincrement())

  turnoId Int

  veiculoRemoteId Int?
  equipeRemoteId  Int?

  latitude  Float
  longitude Float
  accuracy  Float?

  provider     String? @db.VarChar(100)
  batteryLevel Int?
  tagType      String? @db.VarChar(100)
  tagDetail    String? @db.VarChar(255)

  capturedAt DateTime @default(now())
  signature  String   @unique @db.VarChar(128)

  createdAt DateTime  @default(now())
  createdBy String    @db.VarChar(255)
  updatedAt DateTime? @updatedAt
  updatedBy String?   @db.VarChar(255)
  deletedAt DateTime?
  deletedBy String?   @db.VarChar(255)

  @@index([turnoId], map: "idx_mobile_location_turno")
  @@index([capturedAt], map: "idx_mobile_location_captured_at")
}
